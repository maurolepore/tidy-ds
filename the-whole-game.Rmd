---
title: "The whole game"
output: github_document
editor_options: 
  chunk_output_type: console
params:
  continents: !r c("Africa", "Americas", "Asia", "Europe", "Oceania")
---

**Before you start, collapse all chunks with Alt+o**



## Rmarkdown https://rmarkdown.rstudio.com/

* Output a github_document.

* Add chunk options `collapse = TRUE`, `cache = FALSE`, `comments = "#>"`, and `error = TRUE`.

```{r setup-1, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE
  
  
  
  
)
```

```{r setup-2, include=FALSE, eval = FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  collapse = ____, 
  cache = _____, 
  comment = "__",
  error = ____
)
```

```{r setup-3, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  collapse = TRUE, 
  cache = FALSE, 
  comment = "#>",
  error = TRUE
)
```



## Packages https://www.tidyverse.org/

* Use tidyverse packages. Your may also use the packages fs and vroom.

```{r use-tidyverse-1}

```

```{r use-tidyverse-2, eval = FALSE}
library(_________)
```

```{r use-tidyverse-3}
library(tidyverse)
library(fs)
library(vroom)
```



## Import https://readr.tidyverse.org/

* Read all datasets in "data-by-continent/" into a single `messy` tibble.

```{r dir-ls-vroom-1}




```

```{r dir-ls-vroom-2, eval=FALSE}
(csv_files <- fs::dir_ls("_________________"))
_____ <- vroom::vroom(csv_files)

messy
```

```{r dir-ls-vroom-3}
(csv_files <- fs::dir_ls("data-by-continent"))
messy <- vroom::vroom(csv_files)

messy
```

## Transform (part 1) https://dplyr.tidyverse.org/

* Select all numeric columns -- i.e. exclude `continent` and `country`.
* Slice a sample of 5 rows.
* Pull the contents of the pull the first column -- the values are not round.

```{r select-slice-pull-1}




```

```{r select-slice-pull-2, eval=FALSE}
messy %>% 
  select(!_________ & !_______) %>% 
  slice_sample(n = _) %>% 
  pull(_)
```

```{r select-slice-pull-3}
messy %>% 
  select(!continent & !country) %>% 
  slice_sample(n = 5) %>% 
  pull(1)
```

* Round values across numeric columns; assigne the result to `messy`.

```{r mutate-accross-where-1}




```

```{r mutate-accross-where-2, eval=FALSE}
______ <- messy %>% 
  mutate(______(where(is._______), round))

messy
```

```{r mutate-accross-where-3}
messy <- messy %>% 
  mutate(across(where(is.numeric), round))

messy
```



## Tidy https://tidyr.tidyverse.org/

* Pivot the data on everything except `continent` and `country`.

* Separate the messy column into `metric` and `year`.

```{r pivot-longer-1}





```

```{r pivot-longer-2, eval = FALSE}
tidy <- messy2 %>% 
  pivot_______(cols = -_________:-_______) %>% 
  ________(col = name, into = c("______", "____"))

tidy
```

```{r pivot-longer-3}
tidy <- messy2 %>% 
  pivot_longer(cols = -continent:-country) %>% 
  separate(col = name, into = c("metric", "year"))

tidy
```

## Transform more https://dplyr.tidyverse.org/

* Mutate the year column from character to integer.
* Mutate values across the remaining character columns to lower case.
* Filter the `continents` passed to `params`.
* Filter `year` after 1980.
* Select all columns except `country`.

```{r verbs-3}
polished <- tidy %>% 
  mutate(year = as.integer(year)) %>%
  mutate(across(where(is.character), tolower)) %>% 
  filter(continent %in% params$continents) %>% 
  filter(year > 1980) %>% 
  select(-country)

polished
```

TODO: across, groupby and summarize to compute some summary.

## Visualize https://ggplot2.tidyverse.org/

Plot a model for each metric through time:

* Map `color` and `fill` to `continent`.
* Plot model with uncertainty around the mean.
* Facet by `metric` (free the `y` variable -- see `?scales`).

```{r plot-1}



```

```{r plot-2, eval = FALSE}
______(polished, ___(year, value, fill = _________, color = _________)) +
  geom_______() +
  ______wrap(~ ______, scales = "free_y")
```

```{r plot-3}
ggplot(polished, aes(year, value, fill = continent, color = continent)) +
  geom_smooth() +
  facet_wrap(~ metric, scales = "free_y")
```

TODO:  Save output to output/ -- iterage over groups instead of facets?

## Communicate https://rmarkdown.rstudio.com/

* Knit to create a report in .pdf format, then in word format.

