---
title: "The whole game"
output: github_document
editor_options: 
  chunk_output_type: console
params:
  continents: !r c("Africa", "Americas", "Asia", "Europe", "Oceania")
---

**Before you start, collapse all chunks with Alt+o**



## Rmarkdown https://rmarkdown.rstudio.com/

* Output a github_document.

* Add chunk options `collapse = TRUE`, `cache = FALSE`, `comments = "#>"`, and `error = TRUE`.

```{r setup-1, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE
  
  
  
  
)
```

```{r setup-2, include=FALSE, eval = FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  collapse = ____, 
  cache = _____, 
  comment = "__",
  error = ____
)
```

```{r setup-3, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  collapse = TRUE, 
  cache = FALSE, 
  comment = "#>",
  error = TRUE
)
```

* Show which continents this report is about:

```{r params-1}

```

```{r params-2, eval=FALSE}
params$__________
```

```{r params-3}
params$continents
```



## Packages https://www.tidyverse.org/

* Use tidyverse packages.

```{r use-tidyverse-1}

```

```{r use-tidyverse-2, eval = FALSE}
library(_________)
```

```{r use-tidyverse-3}
library(tidyverse)
```



## Import https://readr.tidyverse.org/

* Read messy data from "data/gap_wide.csv".

```{r import-1}


```

```{r import-2, eval = FALSE}
messy <- read_csv("_________________")

messy
```

```{r import-3}
messy <- read_csv("data/gap_wide.csv")

messy
```



## Tidy https://tidyr.tidyverse.org/

* Pivot the data on everything except `continent` and `country`.

* Separate the messy column into `metric` and `year`.

```{r pivot-1}





```

```{r pivot-2, eval = FALSE}
tidy <- messy %>% 
  pivot_______(cols = -_________:-_______) %>% 
  # Watch out! year is a character vector, not a number
  ________(col = name, into = c("______", "____"))

tidy
```

```{r pivot-3}
tidy <- messy %>% 
  pivot_longer(cols = -continent:-country) %>% 
  # Watch out! year is a character vector, not a number
  separate(col = name, into = c("metric", "year"))

tidy
```



## Transform https://dplyr.tidyverse.org/

* Filter the continents passed to `params`.
* Transform the year column from character to integer
* Filter it to include data since 1980.
* Select all columns except `country`.

```{r verbs-1}






```

```{r verbs-2, eval = FALSE}
polished <- tidy %>% 
  ______(year = as.integer(____)) %>%
  ______(year > ____) %>% 
  ______(-_______)

polished
```

```{r verbs-3}
polished <- tidy %>% 
  filter(continent %in% params$continent) %>% 
  mutate(year = as.integer(year)) %>%
  filter(year > 1980) %>% 
  select(-country)

polished
```

TODO: across, groupby and summarize to compute some summary.

## Visualize https://ggplot2.tidyverse.org/

Plot a model for each metric through time:

* Map `color` and `fill` to `continent`.
* Plot model with uncertainty around the mean.
* Facet by `metric` (free the `y` variable -- see `?scales`).

```{r plot-1}



```

```{r plot-2, eval = FALSE}
______(polished, ___(year, value, fill = _________, color = _________)) +
  geom_______() +
  ______wrap(~ ______, scales = "free_y")
```

```{r plot-3}
ggplot(polished, aes(year, value, fill = continent, color = continent)) +
  geom_smooth() +
  facet_wrap(~ metric, scales = "free_y")
```

TODO:  Save output to output/ -- iterage over groups instead of facets?

## Communicate https://rmarkdown.rstudio.com/

* Knit to create a report in .pdf format, then in word format.

