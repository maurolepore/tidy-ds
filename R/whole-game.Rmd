---
title: "Whole game"
output: github_document
params:
  metrics: !r c("gdpPercap", "lifeExp", "pop")
  continents: !r c("Africa", "Americas")
---

**Collapse all chunks with Alt+O / Cmd+Option+O**



## rmarkdown https://rmarkdown.rstudio.com/

* Output a github_document.

* Set your favorite chunk options: `collapse`, `cache`, `comments`, and `error`.

```{r setup-1, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE
  
  
  
  
)
```

```{r setup-2, include=FALSE, eval = FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  collapse = ____, 
  cache = _____, 
  comment = "__",
  error = ____
)
```

```{r setup-3, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  collapse = TRUE, 
  cache = FALSE, 
  comment = "#>",
  error = FALSE
)
```



## Packages https://www.tidyverse.org/

* Use tidyverse packages. 

* Your may also use the packages fs and vroom.

```{r use-tidyverse-1}

```

```{r use-tidyverse-2, eval = FALSE}
library(_________)
```

```{r use-tidyverse-3}
library(tidyverse)
library(here)
library(fs)
library(vroom)
```



## Import https://readr.tidyverse.org/

* Read all datasets in "data/by-continent/" into a single `messy` tibble.

```{r dir-ls-vroom-1}




```

```{r dir-ls-vroom-2, eval=FALSE}
csv_files <- dir_ls(____("data", "____________"))
messy <- vroom(csv_files)
messy <- vroom(_________)

messy
```

```{r dir-ls-vroom-3}
csv_files <- dir_ls(here("data", "by-continent"))
messy <- vroom(csv_files)

messy
```



## Transform (part 1) https://dplyr.tidyverse.org/

* Select all numeric columns -- i.e. exclude `continent` and `country`.

* Slice a sample of 5 rows.

* Pull the contents of the pull the first column -- the values are not round.

```{r select-slice-pull-1}




```

```{r select-slice-pull-2, eval=FALSE}
messy %>% 
  select(!_________ & !_______) %>% 
  slice_sample(n = _) %>% 
  pull(_)
```

```{r select-slice-pull-3}
messy %>% 
  select(!continent & !country) %>% 
  slice_sample(n = 5) %>% 
  pull(1)
```

* Round values across numeric columns.

* Store the result as `messy2`.

```{r mutate-accross-where-1}



```

```{r mutate-accross-where-2, eval=FALSE}
______2 <- messy %>% 
  mutate(______(where(is._______), round))

messy2
```

```{r mutate-accross-where-3}
messy2 <- messy %>% 
  mutate(across(where(is.numeric), round))

messy2
```



## Tidy https://tidyr.tidyverse.org/

* Pivot the data on all columns except `continent` and `country`.

* Separate the messy column into `metric` and `year`.

```{r pivot-longer-separate-1}





```

```{r pivot-longer-separate-2, eval = FALSE}
tidy <- messy2 %>% 
  pivot_______(cols = -c(_________, country)) %>% 
  ________(col = name, into = c("______", "____"))

tidy
```

```{r pivot-longer-separate-3}
tidy <- messy2 %>% 
  pivot_longer(cols = -c(continent, country)) %>% 
  separate(col = name, into = c("metric", "year"))

tidy
```

## Transform (part 2) https://dplyr.tidyverse.org/

* Filter the `metrics` and `continents` passed passed to `params`.

* Mutate the year column from character to integer as `tidy2`.

```{r filter-mutate-1}




```

```{r filter-mutate-2, eval=FALSE}
tidy2 <- tidy %>% 
  ______(metric %in% ______$metrics, _________ %in% ______$continents) %>% 
  ______(year = as._______(____))

tidy2
```

```{r filter-mutate-3}
tidy2 <- tidy %>% 
  filter(metric %in% params$metrics, continent %in% params$continents) %>% 
  mutate(year = as.integer(year))

tidy2
```


* For each `metric` and `continent`, compute the mean and standard error.

```{r group-by-summarize-1}





```

```{r group-by-summarize-2, eval=FALSE}
summaries <- tidy2 %>% 
  group_by(______, _________) %>% 
  _________(mean = mean(value), se = sd(_____) / sqrt(n()))

summaries
```

```{r group-by-summarize-3}
summaries <- tidy2 %>% 
  group_by(metric, continent) %>% 
  summarise(mean = mean(value), se = sd(value) / sqrt(n()))

summaries
```



## Visualize https://ggplot2.tidyverse.org/

Plot a model for each metric through time:

* Map `color` and `fill` to `continent`.
* Plot model with uncertainty around the mean.
* Facet by `metric` (free the `y` variable -- see `?scales`).

```{r geom-smooth-wrap-1}



```

```{r geom-smooth-wrap-2, eval = FALSE}
______(tidy2, ___(year, value, fill = _________, color = _________)) +
  geom_______() +
  ______wrap(~ ______, scales = "free_y")
```

```{r geom-smooth-wrap-3}
ggplot(tidy2, aes(year, value, fill = continent, color = continent)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(~ metric, scales = "free_y")
```

Plot the mean of each metric by continent:

* Set the `fill` to "grey".
* Plot the standard error to show uncertainty around the mean.
* Facet by `metric` (free the `y` variable -- see `?scales`).

```{r geom-col-errorbar-1}




```

```{r geom-col-errorbar-2, eval=FALSE}
ggplot(summaries, aes(_________, ____)) +
  geom____(fill = "____") +
  geom_________(aes(ymin = mean + __, ____ = mean - se)) +
  ______wrap(~ ______, ______ = "free_y")
```

```{r geom-col-errorbar-3}
ggplot(summaries, aes(continent, mean)) +
  geom_col(fill = "grey") +
  geom_errorbar(aes(ymin = mean + se, ymax = mean - se)) +
  facet_wrap(~ metric, scales = "free_y")
```

## Communicate https://rmarkdown.rstudio.com/

* Knit to create a report in .pdf format, then in word format.

TODO: purrr::walk to produce one report per continent.

