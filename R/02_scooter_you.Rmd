---
title: Scooter
output: github_document
params:
  continent:
    choices: [Africa, Americas, Asia, Europe, Oceania]
    multiple: true
    value: [Africa, Americas, Asia, Europe, Oceania]
---

**Collapse all chunks with Alt+O / Cmd+Option+O**



## Review

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, comment = "#>")
```

* Packages.

```{r}
library(tidyverse)
library(here)
```

* Import -- [practice safe paths](https://rstats.wtf/safe-paths.html).

```{r}
gapminder <- read_csv(here("data", "gapminder.csv"))
```



# Your turn

* Explore.

```{r glimpse-1}

```

```{r glimpse-2, eval=FALSE}
gapminder %>% _______()
```

```{r glimpse-3, echo=FALSE}
gapminder %>% glimpse()
```



* Using `filter()`, subset rows where `continent` is "Europe".

```{r filter-continents-1}


```

```{r filter-continents-2, eval=FALSE}
continents <- c("________", "______")
_________ %>% ______(continent %in% continents)
```

```{r filter-continents-3, echo=FALSE}
continents <- "Europe"
gapminder %>% filter(continent %in% continents)
```

Notice the `value` of the `continent` `param` from the YAML header at the top.

```{r}
params
```

* Edit the YAML header so `param` `continent` takes the value Europe.

* Using `filter()`, subset rows where `continent` is `params$continent`.

* Assign the result to `filtered`.

```{r filter-params-continent-1}




```

```{r filter-params-continent-2, eval=FALSE}
filtered <- _________ %>% 
  ______(continent %in% ______$continent)

filtered
```

```{r filter-params-continent-3, echo=FALSE}
filtered <- gapminder %>% 
  filter(continent %in% params$continent)

filtered
```



* From `filtered`, exclude `country` and `continent` with `select()`.

* Store the result as `selected`.

```{r selected-1}




```

```{r selected-2, eval=FALSE}
selected <- filtered %>% 
  ______(-country, -_________)
  select(-country, -continent)

selected
```

```{r selected-3, echo=FALSE}
selected <- filtered %>% 
  select(-country, -continent)

selected
```



* Do it again but subset columns by type with `select(where(` and with `keep()`.
* Store the result as `selected1` and `selected2`; compare with `identical()`.

```{r iterate-by-type-3, echo=FALSE}
selected1 <- filtered %>% select(where(is.numeric))
selected1 %>% identical(selected)

selected2 <- filtered %>% keep(is.numeric)
selected2 %>% identical(selected)
```



## A note on iteration

You've just solved, elegantly, an iteration problem. Solution with `for()`:

```{r demo-for}
# Preallocate
pick <- logical(ncol(filtered))
# Iterate
for (i in seq_along(filtered)) {
  pick[[i]] <- is.numeric(filtered[[i]])
}
selected3 <- filtered[pick]

selected3 %>% identical(selected)
```

> Of course, someone has to write loops. It doesn’t have to be you.
> — Jenny Bryan

In this case, you could also discard character columns with `discard()`:

```{r demo-discard}
# Same
selected4 <- filtered %>% discard(is.character)

selected4 %>% identical(selected)
```

BTW, my use of `identical()` shows inelegant iteration. Let's improve that:

```{r}
list(selected1, selected2, selected3, selected4) %>% 
  map_lgl(identical, selected) %>% 
  all()
```



## Your turn

* Plot a histogram of `lifeExp` (see `?geom_histogram`).

```{r boxplot-1}


```

```{r boxplot-2, eval=FALSE}
ggplot(data = selected, aes(lifeExp)) +
  geom_histogram()
```

```{r boxplot-3, echo=FALSE}
ggplot(data = selected, aes(lifeExp)) +
  geom_histogram()
```

*Histogram of life expectancy in `r params$continent` between `r range(gapminder$year)`.*



* Knit this report for different continents: *Knit > Knit with Parameters ...*.
